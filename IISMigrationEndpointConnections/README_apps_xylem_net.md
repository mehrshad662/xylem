# IIS Endpoint & Connection String Discovery for `apps.xylem.net`

This folder contains PowerShell scripts used to **inventory all IIS applications and virtual directories** under `apps.xylem.net` and to **extract their corresponding endpoint URLs and database connection strings**.

---

## ğŸ“˜ Overview

These scripts are part of the internal Xylem IIS migration and discovery project.  
They were developed and verified on both **DEV** and **PROD** environments to automatically collect:
- IIS site, application, and virtual directory structure
- Endpoint URLs (HTTP/S)
- Database connection strings (SQL or Oracle)
- Masked credentials (no sensitive data exposed)

---

## ğŸ§© Script 1 â€” `Discover-IIS-Targets.ps1`

### ğŸ¯ Purpose
Scans an IIS site (e.g. `apps.xylem.net`) and generates a list of all **applications and virtual directories**, including their names, paths, and physical locations.

### âš™ï¸ Parameters
| Parameter | Description |
|------------|--------------|
| `-SiteName` | The IIS site name (e.g. `"apps.xylem.net"`) |
| `-OutCsv` | Path to save the discovered targets as a CSV file |

### â–¶ï¸ Example
```powershell
.\Discover-IIS-Targets.ps1 `
  -SiteName "apps.xylem.net" `
  -OutCsv "C:\IISMigrate\IIS_Targets_apps_PROD.csv"
```

### ğŸ“„ Output Example
| TargetType | IISPath | Name | PhysicalPath | Site |
|-------------|---------|------|---------------|------|
| Application | /ATP | ATP | C:\inetpub\apps\ATP | apps.xylem.net |
| VirtualDirectory | /ATP/logs | logs | C:\inetpub\apps\ATP\logs | apps.xylem.net |

---

## ğŸ§© Script 2 â€” `Get-EndpointsAndConnections-FromTargets-APPS.ps1`

### ğŸ¯ Purpose
Uses the output from `Discover-IIS-Targets.ps1` to:
- Parse each web.config file
- Extract endpoint URLs (from `http`, `https`, `.asmx`, `.svc`, etc.)
- Extract and **mask** database connection strings (`connectionStrings` or `appSettings`)
- Combine all results into multiple CSV reports for analysis and migration planning

### âš™ï¸ Parameters
| Parameter | Description |
|------------|--------------|
| `-SiteName` | The IIS site name (e.g. `"apps.xylem.net"`) |
| `-TargetsCsv` | Path to the CSV generated by `Discover-IIS-Targets.ps1` |
| `-OutCsv` | Path to store the final combined output |
| `-Hostnames` | Array of hostnames to include (e.g. `@("apps.xylem.net")`) |
| `-Protocol` | `http` or `https` (default: `https`) |

### â–¶ï¸ Example
```powershell
.\Get-EndpointsAndConnections-FromTargets-APPS.ps1 `
  -SiteName "apps.xylem.net" `
  -TargetsCsv "C:\IISMigrate\IIS_Targets_apps_PROD.csv" `
  -OutCsv "C:\IISMigrate\Apps_EndpointsConnections_PROD.csv" `
  -Hostnames @("apps.xylem.net") `
  -Protocol "https"
```

### ğŸ“„ Output Files
After execution, three CSV files are generated in the specified output directory:

| File | Description |
|------|--------------|
| `*_Combined_raw.csv` | Raw data including all endpoints and configs |
| `*_Combined_MATCH.csv` | Only matched endpoints and connection strings |
| `*_Combined_AllTargets.csv` | Consolidated report of all discovered targets |

---

## ğŸ”’ Credential Masking

All sensitive information (passwords, credentials) are automatically **masked** using the following pattern:

```powershell
-replace '(?i)(pwd|password)\s*=\s*([^;]+)', '$1=****'
```

Example:
```
Data Source=10.65.42.80; Initial Catalog=CQM; uid=CQAdmin; pwd=crest966
â†’ Data Source=10.65.42.80; Initial Catalog=CQM; uid=CQAdmin; pwd=****
```

---

## ğŸ“Š Typical Workflow

```powershell
# 1ï¸âƒ£ Generate list of IIS applications and vdirs
.\Discover-IIS-Targets.ps1 `
  -SiteName "apps.xylem.net" `
  -OutCsv "C:\IISMigrate\IIS_Targets_apps_PROD.csv"

# 2ï¸âƒ£ Extract endpoints and database connections
.\Get-EndpointsAndConnections-FromTargets-APPS.ps1 `
  -SiteName "apps.xylem.net" `
  -TargetsCsv "C:\IISMigrate\IIS_Targets_apps_PROD.csv" `
  -OutCsv "C:\IISMigrate\Apps_EndpointsConnections_PROD.csv" `
  -Hostnames @("apps.xylem.net") `
  -Protocol "https"

# 3ï¸âƒ£ (Optional) Convert combined results to Excel inventory format
.\Convert-Combined-ToInventory.ps1 `
  -CombinedCsv "C:\IISMigrate\Apps_EndpointsConnections_PROD.csv" `
  -OutCsv "C:\IISMigrate\Apps_Inventory_PROD.csv"
```

---

## ğŸ§° Folder Structure

```
IIS-Script-Catch-Endpoints/
â”‚
â”œâ”€â”€ Discover-IIS-Targets.ps1
â”œâ”€â”€ Get-EndpointsAndConnections-FromTargets-APPS.ps1
â”œâ”€â”€ Convert-Combined-ToInventory.ps1
â”œâ”€â”€ README.md
â””â”€â”€ Output/
    â”œâ”€â”€ IIS_Targets_apps_PROD.csv
    â”œâ”€â”€ Apps_EndpointsConnections_PROD.csv
    â””â”€â”€ Apps_Inventory_PROD.csv
```

---

## ğŸ‘¤ Author
**Mehrshad Arshi** â€” DevOps Engineer  
Xylem Inc. | Internal DevOps Automation Project 2025  

_Last updated: October 2025_
